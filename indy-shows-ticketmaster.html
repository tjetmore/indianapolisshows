<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indy Shows I Care About</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #151b24;
            --bg-hover: #1a2332;
            --text-primary: #e6e8eb;
            --text-secondary: #9ca3af;
            --accent-1: #3b82f6;
            --accent-2: #8b5cf6;
            --border: #2d3748;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0d1117 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1.5rem;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .venue-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .venue-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .venue-link:hover {
            background: var(--bg-hover);
            border-color: var(--accent-1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .venue-link::before {
            content: 'üéµ';
            font-size: 1.1rem;
        }

        .refresh-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .refresh-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .refresh-btn.loading::before {
            content: '‚ü≥';
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .controls {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .search-box {
            width: 100%;
            padding: 0.9rem 1.2rem;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent-1);
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 0.75rem 1rem;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tab:hover {
            background: var(--bg-hover);
            border-color: var(--accent-1);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .loading-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .loading-state::before {
            content: '‚ü≥';
            display: block;
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: spin 2s linear infinite;
        }

        .shows-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .show-card {
            background: var(--bg-secondary);
            padding: 1.25rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: slideIn 0.4s ease-out backwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .show-card:hover {
            border-color: var(--accent-1);
            background: var(--bg-hover);
            transform: translateX(5px);
            box-shadow: 0 4px 20px var(--shadow);
        }

        .show-date {
            font-family: 'DM Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-1);
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .show-artist {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .show-venue {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .show-link {
            display: inline-block;
            color: var(--accent-2);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .show-link:hover {
            color: var(--accent-1);
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .empty-state::before {
            content: 'üé∏';
            display: block;
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .error-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #ef4444;
            font-size: 1rem;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .error-state::before {
            content: '‚ö†Ô∏è';
            display: block;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 2rem;
            }

            .venue-links {
                flex-direction: column;
            }

            .venue-link, .refresh-btn {
                width: 100%;
                justify-content: center;
            }

            .tab {
                flex: 1 1 auto;
            }

            .show-artist {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Indy Shows I Care About</h1>
            <div class="venue-links">
                <a href="https://www.everwiseamphitheater.com/shows" target="_blank" rel="noopener" class="venue-link">
                    Everwise Calendar
                </a>
                <a href="https://www.ruoffmusiccenter.net/shows" target="_blank" rel="noopener" class="venue-link">
                    Ruoff Calendar
                </a>
                <button id="refreshBtn" class="refresh-btn">
                    üîÑ Refresh Shows
                </button>
            </div>
        </header>

        <div class="controls">
            <input 
                type="text" 
                id="searchBox" 
                class="search-box" 
                placeholder="Search by artist name..."
            >
            <div class="tabs">
                <button class="tab active" data-venue="all">All Shows</button>
                <button class="tab" data-venue="everwise">Everwise</button>
                <button class="tab" data-venue="ruoff">Ruoff</button>
            </div>
        </div>

        <div id="errorContainer"></div>
        <div class="shows-list" id="showsList"></div>

        <footer id="lastUpdated">
            Last updated: <span id="updateTime"></span>
        </footer>
    </div>

    <script>
        const venueNames = {
            everwise: "Everwise Amphitheater",
            ruoff: "Ruoff Music Center"
        };

        let shows = [];
        let currentVenue = 'all';
        let searchQuery = '';
        let isLoading = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            fetchShows();
        });

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    currentVenue = e.target.dataset.venue;
                    renderShows();
                });
            });

            // Search
            document.getElementById('searchBox').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderShows();
            });

            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', () => {
                if (!isLoading) {
                    fetchShows();
                }
            });
        }

        async function fetchShows() {
            if (isLoading) return;
            
            isLoading = true;
            const refreshBtn = document.getElementById('refreshBtn');
            const showsList = document.getElementById('showsList');
            const errorContainer = document.getElementById('errorContainer');
            
            refreshBtn.disabled = true;
            refreshBtn.classList.add('loading');
            refreshBtn.textContent = 'Loading...';
            
            showsList.innerHTML = '<div class="loading-state">Searching Ticketmaster for shows...</div>';
            errorContainer.innerHTML = '';

            try {
                // Search Ticketmaster for both venues
                const everwiseShows = await searchTicketmaster('Everwise Amphitheater Indianapolis', 'everwise');
                const ruoffShows = await searchTicketmaster('Ruoff Music Center Noblesville', 'ruoff');

                shows = [...everwiseShows, ...ruoffShows];
                
                if (shows.length === 0) {
                    errorContainer.innerHTML = `
                        <div class="error-state">
                            No shows found. Please try again.
                        </div>
                    `;
                }
                
                updateTimestamp();
                renderShows();
            } catch (error) {
                console.error('Error fetching shows:', error);
                errorContainer.innerHTML = `
                    <div class="error-state">
                        Error loading shows: ${error.message}
                        <br><br>
                        <small>Please try again or visit the venue websites directly.</small>
                    </div>
                `;
                showsList.innerHTML = '';
            } finally {
                isLoading = false;
                refreshBtn.disabled = false;
                refreshBtn.classList.remove('loading');
                refreshBtn.textContent = 'üîÑ Refresh Shows';
            }
        }

        async function searchTicketmaster(searchQuery, venueKey) {
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 2000,
                        system: "You extract concert data. Return ONLY valid JSON arrays. No explanations, no markdown.",
                        messages: [{
                            role: "user",
                            content: `Search for: site:ticketmaster.com "${searchQuery}" 2026 concerts

Extract all concerts at this venue from the search results. For each show, extract:
- Event name/artist
- Date (convert to YYYY-MM-DD format)
- Ticketmaster URL if available

Return ONLY this JSON:
[{"artist":"Artist Name","date":"2026-06-20","link":"https://www.ticketmaster.com/..."}]`
                        }],
                        tools: [{
                            "type": "web_search_20250305",
                            "name": "web_search"
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                // Extract text
                let responseText = '';
                if (data.content && Array.isArray(data.content)) {
                    responseText = data.content
                        .filter(item => item.type === "text")
                        .map(item => item.text)
                        .join("\n");
                }

                // Parse JSON
                let cleanText = responseText.trim();
                cleanText = cleanText.replace(/```json\s*/g, '').replace(/```\s*/g, '');
                
                const jsonMatch = cleanText.match(/\[[\s\S]*\]/);
                if (!jsonMatch) {
                    console.warn(`No shows found for ${venueKey}`);
                    return [];
                }
                
                const showsData = JSON.parse(jsonMatch[0]);
                
                // Add venue key
                return showsData.map(show => ({
                    date: show.date,
                    artist: show.artist,
                    venue: venueKey,
                    link: show.link || ''
                }));
            } catch (error) {
                console.error(`Error searching ${venueKey}:`, error);
                return [];
            }
        }

        function renderShows() {
            const showsList = document.getElementById('showsList');
            
            if (shows.length === 0 && !isLoading) {
                showsList.innerHTML = '<div class="empty-state">No shows found. Click "Refresh Shows" to try again.</div>';
                return;
            }
            
            // Filter shows
            let filtered = shows.filter(show => {
                const matchesVenue = currentVenue === 'all' || show.venue === currentVenue;
                const matchesSearch = show.artist.toLowerCase().includes(searchQuery);
                return matchesVenue && matchesSearch;
            });

            // Sort by date ascending
            filtered.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Render
            if (filtered.length === 0) {
                showsList.innerHTML = '<div class="empty-state">No shows match your filters</div>';
                return;
            }

            showsList.innerHTML = filtered.map((show, index) => {
                const formattedDate = formatDate(show.date);
                return `
                    <div class="show-card" style="animation-delay: ${index * 0.05}s">
                        <div class="show-date">${formattedDate}</div>
                        <div class="show-artist">${escapeHtml(show.artist)}</div>
                        <div class="show-venue">${venueNames[show.venue]}</div>
                        ${show.link ? `<a href="${escapeHtml(show.link)}" target="_blank" rel="noopener" class="show-link">Ticketmaster ‚Üí</a>` : ''}
                    </div>
                `;
            }).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function updateTimestamp() {
            const now = new Date();
            const formatted = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            document.getElementById('updateTime').textContent = formatted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>